#!/bin/zsh

DIR=$(realpath $(dirname $0))

function bootstrap() {
  # bootstrap scripts and configs
  BTSR="https://github.com/onesmallskipforman/bootstrap.git"
  DOTS="https://github.com/onesmallskipforman/dotfiles.git"
  DATA="https://github.com/onesmallskipforman/userdata.git"

  git clone "$BTSR" "$DIR"                   || git -C "$DIR" pull origin master
  git clone "$DOTS" "$DIR/Home"              || git -C "$DIR" pull origin master
  git clone "$DATA" "$DIR/Home/.local/share" || git -C "$DIR" pull origin master

  # remove old files, then symlink (or copy)
  rm -rf "$HOME"/{.config,.local,.zshenv}
  ln -sf "$DIR/Home"/{.config,.local,.zshenv} "$HOME"
  # cp -r "$DIR/Home"/{.config,.local,.zshenv} "$HOME"
}

if [[ "$1" == "--force" ]] || [[ "$1" == "-f" ]]; then
  doIt;
else
  printf '%s ' "This may overwrite existing files in your home directory. Are you sure? (y/n)";
  read REPLY;

  if [[ $REPLY =~ ^[Yy]$ ]]; then
    bootstrap;
  fi;
fi;
unset doIt;
